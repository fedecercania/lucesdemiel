<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Luces de Miel</title>
  <style>
    html, body {
      height: 100%; margin: 0;
      background: #fff8e1;
    }
    body { margin: 0; color: #6d0013; font-family: Georgia, "Times New Roman", serif; }
    :root { --s: min(32vmin, 260px); }
    .layout { display: flex; min-height: 100vh; }
    .left { flex: 0 0 305px; max-width: 305px; overflow: hidden; }
    .right { flex: 1; display: block; padding: 28px; overflow-y: auto; }
    .frame { width: 305px; height: 100vh; border: 0; display: block; overflow: hidden; }
    .brand { display: flex; align-items: center; gap: 12px; margin-bottom: 8px; }
    .logo { width: 34px; height: 34px; border-radius: 8px; background: conic-gradient(from 0deg, #ffd54f, #ffb300, #ffa000, #ffca28, #ffd54f); border: 2px solid #7b4b27; box-shadow: 0 2px 10px rgba(0,0,0,.08); }
    h1 { margin: 0; color: currentColor; letter-spacing: .2px; font-size: clamp(22px, 3.6vw, 32px); }
    .tag { margin: 6px 0 12px; color: currentColor; font-weight: 800; letter-spacing: .2px; }
    ul { margin: 0; padding-left: 16px; color: #1faa00; font-weight: 800; }
    .note { margin-top: 12px; color: #6b7280; }
    /* Landing right styles */
    .header { position: sticky; top: 0; padding-bottom: 12px; margin-bottom: 18px; }
    .desc { color: #4b5563; line-height: 1.7; max-width: 68ch; }
    .cards { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 16px; margin: 18px 0; }
    .cardx { position: relative; background:
      linear-gradient(135deg, #ffffff 0%, #f8f4e6 50%, #e8f5e8 100%);
      border: 1px solid #f1e2b6; border-radius: 16px; padding: 16px;
      box-shadow: 0 10px 24px rgba(0,0,0,.06);
      transition: transform .18s ease, box-shadow .18s ease;
    }
    .cardx::after { content: ""; position: absolute; inset: 0; border-radius: 16px; padding: 1px;
      background: linear-gradient(135deg, #1faa00, #7b4b27);
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0); -webkit-mask-composite: xor; mask-composite: exclude; 
      pointer-events: none; }
    .cardx:hover { transform: translateY(-3px); box-shadow: 0 14px 32px rgba(0,0,0,.10); }
    .cardx h3 { margin: 0 0 6px; color: currentColor; font-size: 18px; }
    .price { font-weight: 900; color: #1faa00; font-size: 24px; }
    .price .bullet-bordo { color: #6d0013; }
    .thumbs { display: none; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 10px; }
    .thumbs img { width: 100%; height: 80px; object-fit: cover; border-radius: 10px; border: 1px solid #eee; }
    .cardx.open .thumbs { display: grid; }
    .view-btn { margin-top: 10px; display: inline-block; color: #1faa00; font-weight: 800; cursor: pointer; text-decoration: underline; background: none; border: 0; padding: 0; font: inherit; }
    .pickup, .delivery, .reserve { background: #ffffff; border: 1px solid #f1e2b6; border-radius: 16px; padding: 16px; margin: 10px 0 28px; box-shadow: 0 10px 24px rgba(0,0,0,.05); }
    .pickup-info { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin: 12px 0; }
    .pickup-point h4 { margin: 0 0 6px; color: currentColor; }
    .pickup-point p { margin: 0; line-height: 1.5; }
    .delivery-map { width: 100%; height: auto; display: block; border: none; border-radius: 0; margin: 0; }
    .delivery-note { margin: 12px 0 6px; color: #1faa00; font-weight: 800; }
    .precio-display { margin-top: 6px; font-weight: 800; color: #1faa00; font-size: 16px; }
    /* Chat info styles */
    .chat-info { background: rgba(255,255,255,.9); padding: 20px; border-radius: 12px; margin-top: 15px; }
    .chat-description { margin: 0 0 20px; font-size: 16px; color: #6d0013; line-height: 1.6; }
    .contact-info { border-top: 2px solid #1faa00; padding-top: 15px; }
    .contact-item { display: flex; align-items: center; gap: 10px; margin-bottom: 10px; }
    .contact-label { font-weight: 600; color: #6d0013; }
    .contact-link { color: #1faa00; text-decoration: none; font-weight: 600; font-size: 18px; }
    .contact-link:hover { text-decoration: underline; }
    .contact-note { margin: 15px 0 0; font-size: 14px; color: #666; font-style: italic; }
    /* Chat personalizado */
    .chat-container {
      position: fixed; 
      bottom: 20px; 
      right: 20px; 
      display: flex; 
      align-items: center; 
      gap: 0;
      z-index: 100;
    }
    .chat-label {
      background: linear-gradient(135deg, #ffb300 0%, #ff8f00 50%, #e65100 100%);
      color: #5d4037;
      padding: 8px 15px;
      font-size: 12px;
      font-weight: 700;
      text-transform: uppercase;
      white-space: nowrap;
      box-shadow: 0 4px 15px rgba(255, 179, 0, 0.3);
      border: 1px solid #fff3e0;
      border-right: none;
      clip-path: polygon(15% 0%, 100% 0%, 100% 100%, 15% 100%, 0% 50%);
      height: 45px;
      width: 90px;
      display: flex;
      align-items: center;
      justify-content: flex-start;
      padding-left: 15px;
      margin-right: -5px;
    }
    .chat-btn { 
      width: 72px; height: 72px; 
      background: linear-gradient(135deg, #ffb300 0%, #ff8f00 50%, #e65100 100%); 
      color: #5d4037; border: 2px solid #fff3e0; 
      border-left: none;
      cursor: pointer; box-shadow: 0 6px 20px rgba(255, 179, 0, 0.4), inset 0 2px 4px rgba(255,255,255,0.3); 
      transition: all .3s ease;
      clip-path: polygon(50% 0%, 93.3% 25%, 93.3% 75%, 50% 100%, 6.7% 75%, 6.7% 25%);
      display: flex; align-items: center; justify-content: center;
      font-size: 18px;
    }
    .chat-btn:hover { 
      transform: scale(1.1); 
      box-shadow: 0 8px 25px rgba(255, 179, 0, 0.6), inset 0 2px 6px rgba(255,255,255,0.4);
    }
    .chat-widget { position: fixed; bottom: 90px; right: 20px; width: 320px; height: 80vh; max-height: 750px; background: white; border-radius: 16px; box-shadow: 0 8px 24px rgba(0,0,0,.15); display: none; z-index: 101; border: 1px solid #e5e7eb; }
    .chat-widget.open { display: flex; flex-direction: column; }
    .chat-header { background: linear-gradient(135deg, #1faa00, #7b4b27); color: white; padding: 14px 16px; border-radius: 16px 16px 0 0; display: flex; justify-content: space-between; align-items: center; }
    .chat-close { background: none; border: none; color: white; font-size: 18px; cursor: pointer; }
    .chat-body { flex: 1; padding: 16px; display: flex; flex-direction: column; gap: 12px; overflow-y: auto; }
    .chat-message { background: #f1f5f9; padding: 12px; border-radius: 12px; max-width: 80%; font-size: 14px; line-height: 1.5; white-space: pre-wrap; }
    .chat-message.bot { background: #e8f5e8; align-self: flex-start; }
    .chat-message.user { background: #1faa00; color: white; align-self: flex-end; }
    .chat-message.typing { background: #f1f5f9; align-self: flex-start; font-style: italic; color: #666; white-space: normal; }
    .chat-message strong, .chat-message b { font-weight: 800 !important; color: inherit; }
    .chat-message em, .chat-message i { font-style: italic !important; }
    .chat-message a { color: #1faa00 !important; text-decoration: underline; }
    .chat-message ul, .chat-message ol { margin: 8px 0; padding-left: 16px; }
    .chat-message li { margin: 4px 0; }
    .chat-message br { display: block; margin: 4px 0; content: ""; }
    .chat-message p { margin: 8px 0; }
    .chat-input-area { padding: 12px; border-top: 1px solid #e5e7eb; display: flex; gap: 8px; }
    .chat-input { flex: 1; padding: 10px; border: 1px solid #e5e7eb; border-radius: 20px; outline: none; }
    .chat-send { background: #1faa00; color: white; border: none; padding: 10px 16px; border-radius: 20px; cursor: pointer; }
    @media (max-width: 600px) {
      .chat-widget { width: calc(100vw - 40px); height: 70vh; bottom: 80px; right: 20px; }
    }
    .reserve h3 { margin: 0 0 10px; color: currentColor; }
    .form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
    .form .full { grid-column: 1 / -1; }
    .form > div { display: flex; flex-direction: column; }
    .form label { display: block; font-weight: 700; color: currentColor; margin-bottom: 6px; font-size: 14px; }
    .form input, .form select, .form textarea { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #e5e7eb; background: #fffdf7; transition: border-color .15s ease, box-shadow .15s ease; font-size: 14px; box-sizing: border-box; }
    .form input:focus, .form select:focus, .form textarea:focus { outline: none; border-color: #1faa00; box-shadow: 0 0 0 4px rgba(31,170,0,.12); }
    .form textarea { min-height: 80px; resize: vertical; }
    .actions { margin-top: 10px; }
    .btn { background: #1faa00; color: white; border: none; padding: 12px 18px; border-radius: 12px; font-weight: 900; cursor: pointer; box-shadow: 0 10px 22px rgba(31,170,0,.24); transition: transform .12s ease, box-shadow .12s ease; }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 12px 26px rgba(31,170,0,.28); }
    .btn:disabled { opacity: .7; cursor: not-allowed; }
    /* Ocultar panel izquierdo cuando se pida */
    .left.hidden { display: none; }
    @media (max-width: 900px) {
      .layout { flex-direction: column; }
      .left { flex: none; max-width: 100%; width: 100%; height: 50vh; }
      .frame { width: 100%; height: 100%; }
      .right { padding: 20px; }
      .cards { grid-template-columns: 1fr; }
      .form { grid-template-columns: 1fr; }
      .pickup-info { grid-template-columns: 1fr; }
    }
    
    @media (max-width: 600px) {
      .left { height: 40vh; }
      .right { padding: 15px; }
      .header h1 { font-size: 24px; }
      .header .tag { font-size: 14px; }
      .header .desc { font-size: 14px; }
      .cardx { padding: 12px; }
      .cardx h3 { font-size: 16px; }
      .price { font-size: 20px; }
      .reserve { padding: 12px; }
    }
    /* Lightbox */
    .lightbox { position: fixed; inset: 0; background: rgba(0,0,0,.7); display: none; align-items: center; justify-content: center; z-index: 1000; }
    .lightbox.open { display: flex; }
    .lightbox-content { background: #ffffff; border-radius: 16px; padding: 16px; max-width: 900px; width: min(90vw, 900px); max-height: 90vh; overflow: auto; box-shadow: 0 20px 40px rgba(0,0,0,.3); }
    .lightbox-head { display: flex; align-items: center; justify-content: space-between; gap: 10px; margin-bottom: 12px; }
    .lightbox-title { margin: 0; color: #6d0013; font-family: Georgia, "Times New Roman", serif; }
    .lightbox-close { background: none; border: 0; color: #6d0013; font-weight: 900; font-size: 18px; cursor: pointer; }
    .lightbox-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    .lightbox-grid img { width: 100%; height: auto; max-height: 400px; object-fit: contain; border-radius: 12px; border: 1px solid #e5e7eb; background: #fff; }
    @media (max-width: 700px) { .lightbox-grid { grid-template-columns: 1fr 1fr; } .lightbox-grid img { height: auto; max-height: 250px; } }
  </style>
</head>
<body>
  <div class="layout">
    <div class="left">
      <iframe class="frame" src="./panal.html" title="Panal LucesdeMiel"></iframe>
    </div>
    <div class="right">
      <div class="header">
        <div class="brand"><div aria-hidden="true"></div><h1>🍯 Luces de miel</h1></div>
        <div class="tag">Velas artesanales de miel</div>
        <p class="desc">En Luces de miel elaboramos velas artesanales con cera de miel, luz cálida y aromas naturales. Hechas a mano en Ciudad de la Costa, Uruguay, con cuidado en cada detalle para acompañar tus espacios con calidez y color.</p>
      </div>

      <section class="prices">
        <div class="cards">
          <div class="cardx" data-gallery="medianas">
            <h3>Velas medianas (10x1.5 cm)</h3>
            <div class="price">1 por $50 <span class="bullet-bordo">•</span> 2 por $80</div>
            <div class="note">Elegantes y estilizadas, perfectas para decorar.</div>
            <button class="view-btn" type="button" onclick="mostrarImagenes('medianas')">Ver imágenes</button>
           
          </div>
          <div class="cardx" data-gallery="cortas">
            <h3>Velas cortas (5x3 cm)</h3>
            <div class="price">1 por $80 <span class="bullet-bordo">•</span> 2 por $120</div>
            <div class="note">Más duraderas, aroma intenso y luz cálida.</div>
            <button class="view-btn" type="button" onclick="mostrarImagenes('cortas')">Ver imágenes</button>
           
          </div>
        </div>
        
      </section>

      <section class="pickup">
        <h3>Puntos de retiro</h3>
        <div class="pickup-info">
          <div class="pickup-point">
            <h4>📍 Pinar Sur</h4>
            <p>Océano Pacífico y Venezuela</p>
          </div>
          <div class="pickup-point">
            <h4>📍 Pinar Norte</h4>
            <p>18 de Julio y Austria</p>
          </div>
        </div>
        <p class="note">Retiro con previa coordinación por WhatsApp.</p>
      </section>

      <section class="delivery">
        <h3>Zona de entregas</h3>
        <div class="delivery-info">
          <img src="./mapa-entregas.png" alt="Mapa zona de entregas" class="delivery-map" />
          <p class="delivery-note">🚚 <strong>Monto mínimo de entrega: $250</strong></p>
          <p class="note">Entregamos en la zona marcada. Consultá disponibilidad de horarios.</p>
        </div>
      </section>

      <section class="reserve">
        <h3>💬 Reservas y consultas</h3>
        <div class="chat-info">
          <p class="chat-description">Usá el chat para hacer tu reserva o consultar cualquier duda sobre nuestros productos.</p>
        </div>
      </section>
    </div>
  </div>
  <!-- Lightbox -->
  <div id="lightbox" class="lightbox" aria-modal="true" role="dialog" aria-hidden="true">
    <div class="lightbox-content">
      <div class="lightbox-head">
        <h3 id="lightbox-title" class="lightbox-title">Imágenes</h3>
        <button class="lightbox-close" aria-label="Cerrar">Cerrar ✕</button>
      </div>
      <div class="lightbox-grid" id="lightbox-grid"></div>
    </div>
  </div>

  <!-- Chat personalizado -->
  <div class="chat-container">
    <button class="chat-btn" onclick="toggleChat()" title="Chat con nosotros">🕯️</button>
  </div>
  
  <div id="chat-widget" class="chat-widget">
    <div class="chat-header">
      <span>🕯️ Reservas y Consultas</span>
      <button class="chat-close" onclick="toggleChat()">✕</button>
    </div>
    <div class="chat-body" id="chat-body">
      <div class="chat-message bot">¡Hola! 👋 Bienvenido a Luces de Miel</div>
      <div class="chat-message bot">¿Tenés alguna consulta sobre nuestras velas?</div>
    </div>
    <div class="chat-input-area">
      <input class="chat-input" id="chat-input" placeholder="Escribe tu consulta..." onkeypress="if(event.key==='Enter') enviarMensaje()" />
      <button class="chat-send" onclick="enviarMensaje()">Enviar</button>
    </div>
  </div>
  
  <script>
    // En móviles: mostrar el panal 20s y luego ocultarlo
    document.addEventListener('DOMContentLoaded', function () {
      const isMobile = window.matchMedia('(max-width: 900px)').matches;
      if (isMobile) {
        setTimeout(function () {
          var left = document.querySelector('.left');
          if (left) left.classList.add('hidden');
        }, 20000); // 20 segundos
      }

      // Abrir chat automáticamente al llegar al fondo del panel derecho
      var right = document.querySelector('.right');
      var chatAutoOpened = false;
      if (right) {
        right.addEventListener('scroll', function () {
          if (chatAutoOpened) return;
          var atBottom = right.scrollTop + right.clientHeight >= right.scrollHeight - 20;
          if (atBottom) {
            var widget = document.getElementById('chat-widget');
            if (widget && !widget.classList.contains('open')) {
              toggleChat();
            }
            chatAutoOpened = true;
          }
        });
      }

      // Fallback: abrir chat al llegar al fondo del documento (scroll de ventana)
      window.addEventListener('scroll', function () {
        if (chatAutoOpened) return;
        var atBottomDoc = window.innerHeight + window.scrollY >= document.documentElement.scrollHeight - 20;
        if (atBottomDoc) {
          var widget = document.getElementById('chat-widget');
          if (widget && !widget.classList.contains('open')) {
            toggleChat();
          }
          chatAutoOpened = true;
        }
      }, { passive: true });
    });

    function mostrarImagenes(tipo) {
      const lightbox = document.getElementById('lightbox');
      const grid = document.getElementById('lightbox-grid');
      const title = document.getElementById('lightbox-title');
      
      grid.innerHTML = '';
      let imgs = [];
      
      if (tipo === 'medianas') {
        title.textContent = 'Velas medianas (10x1.5 cm)';
        imgs = ['./fotos/UnaVela_1.jpeg', './fotos/UnaVela_2.jpeg', './fotos/UnaVela_3.jpeg'];
      } else if (tipo === 'cortas') {
        title.textContent = 'Velas cortas (5x3 cm)';
        imgs = [
          './fotos/Vela corta 5x3cm encendida.jpeg',
          './fotos/Vela corta 5x3cm encendida .jpeg',
          './fotos/Vela corta 5x3 cm encendida.jpeg'
        ];
      }
      
      imgs.forEach(src => {
        const img = document.createElement('img');
        // Codificar por si hay espacios u otros caracteres
        if (src.startsWith('./fotos/')) {
          const base = './fotos/';
          const file = src.slice(base.length);
          img.src = base + encodeURIComponent(file);
        } else {
          img.src = src;
        }
        img.alt = title.textContent;
        grid.appendChild(img);
      });
      
      lightbox.classList.add('open');
      lightbox.setAttribute('aria-hidden', 'false');
    }
    
    function calcularPrecio() {
      const tipo = document.getElementById('tipo').value;
      const cantidad = parseInt(document.getElementById('cantidad').value) || 0;
      const display = document.getElementById('precio-total');
      
      if (!tipo || cantidad <= 0) {
        display.textContent = '';
        return;
      }
      
      // Precios base: medianas 1×$50, 2×$80 | cortas 1×$80, 2×$120
      let precio = 0;
      if (tipo === 'mediana') {
        if (cantidad === 1) precio = 50;
        else if (cantidad === 2) precio = 80;
        else precio = 50 + ((cantidad - 1) * 30); // $30 por cada adicional
      } else if (tipo === 'corta') {
        if (cantidad === 1) precio = 80;
        else if (cantidad === 2) precio = 120;
        else precio = 80 + ((cantidad - 1) * 40); // $40 por cada adicional
      }
      
      display.textContent = `Total: $${precio}`;
      validarModalidad(); // Revalidar modalidad cuando cambie el precio
    }

    function validarModalidad() {
      const modalidad = document.getElementById('modalidad').value;
      const precioTexto = document.getElementById('precio-total').textContent;
      const precio = parseInt(precioTexto.replace(/[^0-9]/g, '')) || 0;
      const submitBtn = document.querySelector('.btn[type="submit"]');
      
      if (modalidad === 'entrega' && precio < 250) {
        submitBtn.disabled = true;
        submitBtn.textContent = '❌ Monto mínimo $250 para entrega';
        submitBtn.style.background = '#ccc';
      } else {
        submitBtn.disabled = false;
        submitBtn.textContent = '📱 Reservar por WhatsApp';
        submitBtn.style.background = '#1faa00';
      }
    }

    function enviarReserva() {
      const nombre = document.getElementById('nombre').value;
      const contacto = document.getElementById('contacto').value;
      const tipo = document.getElementById('tipo').value;
      const cantidad = document.getElementById('cantidad').value;
      const modalidad = document.getElementById('modalidad').value;
      const zona = document.getElementById('zona').value;
      
      // Calcular precio
      calcularPrecio();
      const precioTexto = document.getElementById('precio-total').textContent;
      
      const tipoTexto = tipo === 'mediana' ? 'medianas (10x1.5cm)' : 'cortas (5x3cm)';
      const cantidadEmoji = '🕯️'.repeat(Math.min(cantidad, 5));
      const productoTexto = `${cantidadEmoji} ${cantidad} vela${cantidad > 1 ? 's' : ''} ${tipoTexto} - ${precioTexto}`;
      const modalidadTexto = modalidad === 'pickup' ? '📍 Pickup (retiro en punto)' : '🚚 Entrega a domicilio';
      
      let mensajeWhatsApp = `🕯️ *Reserva Luces de Miel* 🍯

👤 *Nombre:* ${nombre}
📱 *Contacto:* ${contacto}
${productoTexto}
${modalidadTexto}
📍 *Zona:* ${zona || 'No especificada'}`;
      
      mensajeWhatsApp += `\n\n¡Hola! Me interesa hacer una reserva de velas artesanales.`;
      
      const telefono = '59894948283';
      const url = `https://wa.me/${telefono}?text=${encodeURIComponent(mensajeWhatsApp)}`;
      
      window.open(url, '_blank');
    }

    // Generar UUID único para la sesión de chat
    let chatSessionId = null;
    
    function generateUUID() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0;
        const v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }

    function toggleChat() {
      const widget = document.getElementById('chat-widget');
      widget.classList.toggle('open');
      if (widget.classList.contains('open')) {
        // Generar UUID solo la primera vez que se abre
        if (!chatSessionId) {
          chatSessionId = generateUUID();
          console.log('Nueva sesión de chat:', chatSessionId);
        }
        document.getElementById('chat-input').focus();
      }
    }

    async function enviarMensaje() {
      const input = document.getElementById('chat-input');
      const mensaje = input.value.trim();
      if (!mensaje) return;
      
      const chatBody = document.getElementById('chat-body');
      
      // Agregar mensaje del usuario
      const userMsg = document.createElement('div');
      userMsg.className = 'chat-message user';
      userMsg.textContent = mensaje;
      chatBody.appendChild(userMsg);
      
      // Limpiar input
      input.value = '';
      
      // Mostrar indicador de escritura
      const typingMsg = document.createElement('div');
      typingMsg.className = 'chat-message typing';
      typingMsg.textContent = 'Escribiendo...';
      chatBody.appendChild(typingMsg);
      
      // Scroll al final
      chatBody.scrollTop = chatBody.scrollHeight;
      
      try {
        // Enviar a n8n con basic auth
        console.log('Enviando mensaje a n8n:', mensaje);
        const response = await fetch('https://n8n.cercania.net/webhook/d7c91fd0-d79c-4bd4-9ddf-6474fcf38a80', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Basic ' + btoa('n8n:n8n')
          },
          body: JSON.stringify({
            sid: chatSessionId,
            message: mensaje
          })
        });
        
        // Quitar indicador de escritura
        if (typingMsg.parentNode) chatBody.removeChild(typingMsg);
        
        if (response.ok) {
          const contentType = response.headers.get('content-type');
          console.log('Content-Type:', contentType);
          let respuestaTexto = '';
          
          if (contentType && contentType.includes('application/json')) {
            const data = await response.json();
            console.log('Respuesta JSON de n8n:', data);
            console.log('Campos disponibles:', Object.keys(data));
            respuestaTexto = data.response || data.message || data.reply || data.text || data.output || data.result || JSON.stringify(data);
          } else {
            respuestaTexto = await response.text();
            console.log('Respuesta texto de n8n:', respuestaTexto);
            // Convertir **texto** a <strong>texto</strong>
            respuestaTexto = respuestaTexto.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
          }
          
          console.log('Texto final a mostrar:', respuestaTexto);
          
          const botMsg = document.createElement('div');
          botMsg.className = 'chat-message bot';
          botMsg.innerHTML = respuestaTexto;
          chatBody.appendChild(botMsg);
        } else {
          console.error('Error HTTP:', response.status);
          throw new Error('Error en la respuesta');
        }
      } catch (error) {
        console.error('Error enviando mensaje:', error);
        // Quitar indicador de escritura
        if (typingMsg.parentNode) chatBody.removeChild(typingMsg);
        
        // Respuesta de fallback
        const botMsg = document.createElement('div');
        botMsg.className = 'chat-message bot';
        botMsg.textContent = '¡Gracias por tu consulta! Te responderemos por WhatsApp pronto. 📱';
        chatBody.appendChild(botMsg);
      }
      
      // Scroll al final
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    
    // Cerrar lightbox
    document.addEventListener('click', function(e) {
      if (e.target.closest('.lightbox-close') || e.target.id === 'lightbox') {
        const lb = document.getElementById('lightbox');
        lb.classList.remove('open');
        lb.setAttribute('aria-hidden', 'true');
      }
    });
  </script>
</body>
</html>


